<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Anúncio Disney</title>
<link rel="icon" href="../favicon.jpeg">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: 'Inter', sans-serif;
    background: #000000;
    margin: 0;
    padding: 0;
    color: #0f172a;
  }

  a {
    text-decoration: none;
  }

  .logo {
  margin: 20px;
  top: 15px;
  left: 15px;
  z-index: 999;
}

.logo img {
  width: 130px; 
}

  .container {
    max-width: 1100px;
    margin: 30px auto;
    padding: 20px;
    background: #000000;
  }

  .product {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 40px;
  }

  .thumb {
    width: 420px;
    height: 300px;
    border-radius: 12px;
    background-size: cover;
    background-position: center;
  }

  .info {
    max-width: 450px;
    color: white;
  }

  h1 {
    margin: 0 0 10px;
    font-size: 28px;
    color: white;
  }
  .desc {
    color: #acb1b9;
    font-size: 14px;
    margin-bottom: 18px;
  }
  .price {
    font-size: 26px;
    color: #f02626;
    font-weight: 700;
    margin: 16px 0;
  }

  label {
    font-weight: 600;
    display: block;
    margin-bottom: 6px;
  }
  select {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid rgba(238, 238, 238, 0.2);
    font-size: 15px;
    width: 220px;
  }

  .btn {
    border-radius: 8px;
    display: inline-block;
    text-decoration: none;
    padding: 12px 28px;
    background: #1f7de6;
    color: #fff;
    font-weight: 700;
    font-size: 14px;
    border: none;
    cursor: pointer;
  }
  .btn:hover {
    opacity: 0.9;
  }
  .qtd-p {
    color: white;
  }


  .recommendations {
    margin-top: 40px;
  }
  .recommendations h2 {
    color: white;
    margin-bottom: 20px;
  }
  .ad-list {
    display: flex;
    gap: 15px;
    overflow-x: auto;
  }
  .ad-item {
    flex: 0 0 auto;
    width: 120px;
    background: #0a0a0a;
    border-radius: 5px;
    padding: 10px;
    text-align: center;
    border: 1px solid #222;
  }
  .ad-thumb {
    width: 100px;
    height: 60px;
    background-size: cover;
    background-position: center;
    margin: 0 auto 10px;
    border-radius: 4px;
  }
  .ad-info p {
    margin: 4px 0;
    font-size: 12px;
    color: #ccc;
  }

  @media (max-width: 750px) {
    .product {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .thumb {
      width: 90%;
      height: auto;
      aspect-ratio: 16/11;
    }

    .info {
      text-align: center;
    }

    .help {

    }
  }

  /* ===== SELECT ESTILIZADO ===== */

.custom-select {
  width: 280px;
  position: relative;
  font-family: 'Inter', sans-serif;
}

.select-box {
  background: #121212;
  border: 1px solid #2a2a2a;
  padding: 12px 15px;
  border-radius: 10px;
  color: white;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.select-box span {
  font-size: 15px;
  color: #d1d1d1;
}

.options {
  display: none;
  position: absolute;
  top: 52px;
  left: 0;
  width: 100%;
  background: #0d0d0d;
  border: 1px solid #2a2a2a;
  border-radius: 10px;
  overflow-y: auto;
  max-height: 260px;
  z-index: 1000;
  padding: 10px 0;
}

.option {
  padding: 12px 15px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: 0.15s;
}

.option:hover {
  background: #1a1a1a;
}

.option-info {
  display: flex;
  flex-direction: column;
}

.option-title {
  color: white;
  font-size: 14px;
  font-weight: 600;
}

.option-stock {
  color: #888;
  font-size: 12px;
}

.option-price {
  color: #2aa6ff;
  font-weight: 700;
  font-size: 15px;
}


.warning-box {
  display: none;
  background: #ff3b3b;
  color: white;
  padding: 12px 15px;
  border-radius: 8px;
  font-size: 14px;
  margin-bottom: 12px;
  font-weight: 600;
  text-align: center;
  animation: fadeIn 0.3s ease-out;
}

/* animação suave */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-5px); }
  to { opacity: 1; transform: translateY(0); }
}

</style>
</head>
<body>

<a href="../index.html">
    <div class="logo">
      <img src="../favicon.jpeg" alt="Logo">
    </div>
</a>    




<div class="container">

<div class="container">
  <div class="product">
    <div class="thumb" style="background-image:url('../anuncios/anunciodisney.png')"></div>
    <div class="info">
      <h1>Disney Plus</h1>
      <p class="desc">Acesso completo à Disney, com filmes, séries e conteúdos exclusivos.</p>
     <label><p class="qtd-p">Escolha um item:</p></label>

<div class="custom-select">
  
  <div class="select-box" onclick="toggleOptions()">
    <span id="selectedText">Selecione uma opção</span>
    ▼
  </div>

  <div class="options" id="optionsList">

    <div class="option" onclick="selectOption('Disney Plus 1 mês', '0 disponíveis', 'R$ 5,90')">
      <div class="option-info">
        <span class="option-title">Disney Plus 1 mês</span>
        <span class="option-stock">(0 em estoque)</span>
      </div>
      <span class="option-price">R$ 5,90</span>
    </div>

  </div>
  <br>
    <div id="warningBox" class="warning-box">Selecione o Item desejado.</div>
    <button onclick="gerarPagamento()" class="btn">Comprar</button>


  </div>
  <br /><br />

  <div class="recommendations">
    <h2>[Anúncios semelhantes]</h2>
    <div class="ad-list">
      <div class="ad-item">
        <a href="netflix.html">
            <div class="ad-thumb" style="background-image:url('../anuncios/anuncionetflix.png')"></div>
            <div class="ad-info">
              <p>Netflix</p>
              <p>R$ 10,90</p>
            </div>
        </a>
      </div>
      <div class="ad-item">
        <a href="paramountplus.html">
            <div class="ad-thumb" style="background-image:url('../anuncios/anuncioparamount.png')"></div>
            <div class="ad-info">
              <p>Paramount Plus</p>
              <p>R$ 7,90</p>
            </div>
            </div>
        </a>
    </div>
  </div>
  <br><br><br>
  <br><br><br>
   <div class="help">
    <h1>Em dúvidas ou problemas com sua compra, consulte: <a href="">/Help.</a></h1>
  </div>
</div>

<script>
let selectedItem = null;

// ==========================
// FUNÇÕES DO SELECT PERSONALIZADO
// ==========================

// Alterna a exibição das opções
function toggleOptions() {
    document.getElementById('optionsList').style.display =
        document.getElementById('optionsList').style.display === 'block'
            ? 'none'
            : 'block';
}

// Lógica de Seleção de Opção
function selectOption(title, stock, price) {
    // 1. LIMPA E SALVA O ITEM SELECIONADO (CHAVE PARA O PAGAMENTO)
    const cleanPrice = price.replace("R$", "").replace(",", ".").trim();
    selectedItem = { 
        title: title, 
        // Armazena o preço no formato "5.90" para facilitar o envio ao LivePix
        price: cleanPrice 
    }; 

    // 2. ATUALIZA O TEXTO EXIBIDO
    document.getElementById("selectedText").innerHTML = `
        ${title} — <span style="color:#2aa6ff; font-weight:700;">${price}</span>
    `;

    // 3. FECHA O MENU
    document.getElementById('optionsList').style.display = 'none';

    // Opcional: Remover aviso se o usuário selecionar após o erro
    document.getElementById("warningBox").style.display = "none";
}

// Fecha o select clicando fora
document.addEventListener('click', function (e) {
    if (!document.querySelector('.custom-select').contains(e.target)) {
        document.getElementById('optionsList').style.display = 'none';
    }
});


// ==========================
// GERAR PAGAMENTO E REDIRECIONAMENTO
// ==========================
async function gerarPagamento() {
    // 1. VERIFICA SE O ITEM FOI SELECIONADO
    if (!selectedItem) {
        let box = document.getElementById("warningBox");
        box.style.display = "block";
        setTimeout(() => box.style.display = "none", 2500);
        return;
    }

    // 2. TENTA GERAR O PAGAMENTO
    try {
        const response = await fetch("/.netlify/functions/gerarPagamento", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                item: {
                    // Usa o preço já limpo da função selectOption (ex: "5.90")
                    price: selectedItem.price, 
                    title: selectedItem.title
                }
            })
        });

        const data = await response.json();

        // >>>>>>> MUDANÇA AQUI: TRATAMENTO DE ERRO APRIMORADO <<<<<<<
        if (!data || data.error) {
            let details = '';
            if (data?.detalhes) {
                // Tenta exibir a mensagem específica da API
                details = data.detalhes.message || JSON.stringify(data.detalhes);
            }
            
            // Exibe um alerta com a mensagem de erro do backend e detalhes
            alert("Erro ao gerar pagamento: " + (data?.error || "desconhecido") + 
                  (details ? `\nDetalhes: ${details}` : ''));
            
            console.error("Erro completo:", data);
            return;
        }
        // >>>>>>> FIM DA MUDANÇA <<<<<<<

        // 3. REDIRECIONAMENTO PARA O LIVEPIX
        const link = data.checkout_url || data.charge_url;

        if (!link) {
            alert("Erro: o servidor não retornou o link de pagamento.");
            return;
        }

        // Ação principal: Redireciona o usuário para o link do LivePix
        window.location.href = link;

    } catch (error) {
        alert("Erro ao conectar com o servidor. Verifique o Netlify Functions.");
        console.error(error);
    }
}
</script>

</body>
</html>